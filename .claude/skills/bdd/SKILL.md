# BDD受入基準作成

曖昧な仕様や要求、ユーザーストーリーから、形式化された実行可能な受入基準を作成します。Behavior-Driven Development (BDD) の原則に基づき、3つの技法（Active Listening、Example Mapping、Formulation）をイテレーティブかつ対話的に使い分けながら、仕様を発見し、Gherkin形式で文書化します。

## 入力と出力

### 入力
- 曖昧な仕様や要求
- 未整理のユーザーストーリー
- ステークホルダーの口頭での説明
- 既存ドキュメントの断片

### 出力
- 形式化された受入基準（Gherkin形式 .feature ファイル）
- ビジネスルールの明確な定義
- 実行可能なテストシナリオ
- 未解決の質問リスト（優先度付き）

## 使用タイミング

- プロダクトバックログアイテムの詳細化が必要な時
- 曖昧な要求を明確な仕様に変換したい時
- 開発前に実装スコープを確定したい時
- ステークホルダー間で仕様の共通理解を得たい時
- テスト駆動開発 (TDD) / BDDのサイクルを開始する時

## 対話的・イテレーティブなアプローチ

このskillは**線形的なフェーズではなく**、3つの技法を状況に応じて使い分ける「引き出し」として提供します。

```
        ┌─────────────────────────────────────┐
        │   曖昧な要求                        │
        └─────────────────────────────────────┘
                      │
                      ↓
        ┌─────────────────────────────────────┐
        │                                     │
        │   対話的・イテレーティブプロセス    │
        │                                     │
        │   ┌──────────────────────┐          │
        │   │ Active Listening     │←─┐      │
        │   │ (傾聴・深掘り)        │  │      │
        │   └──────────────────────┘  │      │
        │            ↕                 │      │
        │   ┌──────────────────────┐  │      │
        │   │ Example Mapping      │  │      │
        │   │ (構造化・可視化)      │←─┤      │
        │   └──────────────────────┘  │      │
        │            ↕                 │      │
        │   ┌──────────────────────┐  │      │
        │   │ Formulation          │  │      │
        │   │ (形式化・文書化)      │──┘      │
        │   └──────────────────────┘          │
        │                                     │
        │   ※必要に応じて行き来する           │
        │                                     │
        └─────────────────────────────────────┘
                      │
                      ↓
        ┌─────────────────────────────────────┐
        │   形式化された受入基準              │
        └─────────────────────────────────────┘
```

### いつ、どの技法を使うか

#### Active Listening を使うタイミング

```
🎯 こんな時に:
- 要求が曖昧で、何を実現したいのか分からない
- ステークホルダーの発言に矛盾がある
- ビジネス価値が不明確
- スコープの境界が曖昧
- Example Mapping中に根本的な疑問が生じた

📘 使える技法:
- ソクラテス式問答
- 5 Whys
- 仮説検証
- オープンクエスチョン

📄 詳細: `active-listening/SKILL.md`
```

#### Example Mapping を使うタイミング

```
🎯 こんな時に:
- 要求の概要は分かったが、具体的なルールが不明
- ビジネスルールを整理したい
- エッジケースや境界値を洗い出したい
- ステークホルダーと共通理解を得たい
- Active Listeningで得た情報を構造化したい

📥 入力: ユーザーストーリー(自然言語、日本語)
📤 出力: 構造化JSON(story/rules/examples/questions/next_actions/metadata)

📘 使える技法:
- カラーカードシステム
- 25分タイムボックス
- 3 Amigos視点(Developer/Tester/Product Owner)

🏢 FP&A SaaS特化考慮:
- 既存機能との整合性
- 権限・承認フローへの影響
- Excel出力への影響
- UI/UX制約
- データ整合性

📄 詳細: `example-mapping/SKILL.md`
```

#### Formulation を使うタイミング

```
🎯 こんな時に:
- ビジネスルールと具体例が整理された
- Gherkin形式で文書化したい
- 開発者に実装可能な形式で渡したい
- 自動テストの基盤を作りたい
- Example Mapping中に一部のルールだけ先に形式化したい

📘 使える技法:
- Specification by Example
- Given-When-Thenパターン
- Ruleキーワード

📄 詳細: `formulation/SKILL.md`
```

## 対話例: イテレーティブなプロセス

```
ユーザー: ログイン機能の受入基準を作成したい

Claude: [BDD skill起動]
        まず、ログイン機能について教えてください。

ユーザー: メールアドレスとパスワードでログインできるようにしたい

Claude: [Active Listening 使用]
        なぜログイン機能が必要なのですか?

ユーザー: ユーザーごとに異なる情報を表示したいから

Claude: [5 Whys継続]
        なぜユーザーごとに異なる情報を表示したいのですか?

ユーザー: 購入履歴に基づいたおすすめ商品を表示したい

Claude: なるほど。つまり真の目的は「パーソナライゼーション」ですね。
        では、ログイン機能の具体的なルールを整理しましょう。

        [Example Mapping に切り替え]

        📄 Story: ユーザーがログインして個人化された体験を得る

        ビジネスルールを洗い出しましょう。
        まず、どんな場合にログインできますか?

ユーザー: 正しいメールアドレスとパスワードを入力した場合

Claude: 📘 Rule 1: 有効な認証情報でログインできる

        逆に、ログインできない場合は?

ユーザー: パスワードが間違っている場合

Claude: 📘 Rule 2: 無効な認証情報ではログインできない

        パスワードを何回も間違えた場合は?

ユーザー: あ、セキュリティのためにアカウントロックが必要かも

Claude: [Active Listening に戻る]
        アカウントロックの要件を詳しく聞かせてください。
        - 何回失敗でロック?
        - ロック期間は?
        - ロック解除方法は?

ユーザー: うーん、業界標準に従えば良いかな

Claude: [仮説検証]
        では、以下の仮説で進めて良いですか?
        - 5回連続失敗でロック
        - 30分間ロック
        - 30分経過後は自動解除

ユーザー: はい、それで良いです

Claude: 📘 Rule 3: 連続ログイン失敗でアカウントロック

        [Example Mapping 継続]
        では、Rule 1の具体例を考えましょう。
        正しい認証情報でログインした場合、何が起きますか?

ユーザー: ダッシュボード画面に遷移します

Claude: 📗 Example 1.1: 正しい認証情報でログイン
           Given: ユーザー alice@example.com が登録されている
           When: 正しいメールアドレスとパスワードを入力
           Then: ダッシュボード画面に遷移

        このルールは形式化できそうですね。

        [Formulation に移行]
        Rule 1をGherkin形式にしてみます:

        Rule: 有効な認証情報でログインできる
          Example: 正しい認証情報でログイン
            Given ユーザー "alice@example.com" が登録されている
            When メールアドレス "alice@example.com" を入力する
            And パスワード "SecurePass123" を入力する
            And ログインボタンをクリックする
            Then ダッシュボード画面に遷移する

        これで合っていますか?

ユーザー: はい!

Claude: [Example Mapping に戻る]
        では、Rule 2と3の具体例も整理しましょう...

        [このようにイテレーティブに進める]
```

## 技法の「引き出し」

### Active Listening（傾聴・要求抽出）

**目的:** ステークホルダーの真のニーズを理解する

**主な技法:**
- ソクラテス式問答による深掘り
- 5 Whys技法で根本原因を発見
- 仮説検証による認識の擦り合わせ
- オープンクエスチョンで視野を広げる

**成果物:**
- 構造化された要求の理解
- ユーザーペルソナの明確化
- ビジネス価値の特定
- スコープの境界確定

**詳細:** `active-listening/SKILL.md`

### Example Mapping（構造化・可視化）

**目的:** 要求をビジネスルールと具体例に分解する

**主な技法:**
- カラーカードシステムによる可視化
  - 📄 Story (黄): ユーザーストーリー
  - 📘 Rules (青): ビジネスルール
  - 📗 Examples (緑): 具体例
  - 📕 Questions (赤): 未解決の質問
- 25分のタイムボックス
- 3 Amigos視点（開発者・テスター・PO）での検証

**成果物:**
- ビジネスルールのリスト
- 各ルールを説明する具体例
- 未解決の質問（優先度付き）
- ストーリー分割の判断材料

**詳細:** `example-mapping/SKILL.md`

### Formulation（例示による仕様化）

**目的:** 実行可能な受入基準として形式化する

**主な技法:**
- Specification by Example（例示による仕様化）
- Given-When-Thenパターンの適用
- Ruleキーワードによるグループ化
- ビジネス言語でのシナリオ記述

**成果物:**
- Gherkin形式の .feature ファイル
- 実行可能なテストシナリオ
- 品質検証済みの受入基準

**詳細:** `formulation/SKILL.md`

## 対話のパターン

### パターン1: 要求が曖昧な場合

```
1. Active Listening で深掘り
   ↓
2. 理解が深まったら Example Mapping で構造化
   ↓
3. 明確になったルールから順次 Formulation
```

### パターン2: 要求は明確だが詳細が不足

```
1. Example Mapping でルールと具体例を洗い出し
   ↓
2. 曖昧な部分が出たら Active Listening に戻る
   ↓
3. 整理されたルールを Formulation
```

### パターン3: 既存の仕様を改善

```
1. Formulation で現在の仕様をレビュー
   ↓
2. 不明瞭な部分を Example Mapping で再整理
   ↓
3. 根本的な疑問は Active Listening で確認
```

## 品質基準

作成した受入基準は以下を満たす必要があります:

### ビジネス観点
- [ ] ビジネス価値が明確
- [ ] ビジネス用語で記述されている
- [ ] ステークホルダーが理解できる
- [ ] 実装の詳細を含まない

### 技術観点
- [ ] 実行可能な形式
- [ ] 検証可能な期待結果
- [ ] 各Exampleは単一の振る舞いを表現
- [ ] 各Exampleは3-5ステップ以内

### プロセス観点
- [ ] 対話を通じて作成された
- [ ] 3つの視点（開発・テスト・ビジネス）で検証済み
- [ ] 未解決の質問が記録されている
- [ ] スコープが明確

## ベストプラクティス

### DO ✅
1. **イテレーティブに進める**: 一方向ではなく、必要に応じて技法を切り替える
2. **対話を重視**: 一方的に生成せず、質問と確認を繰り返す
3. **具体例で話す**: 抽象論を避け、常に具体例で確認
4. **曖昧さを排除**: 不明点は Active Listening に戻って深掘り
5. **部分的に形式化**: すべてを整理してから形式化するのではなく、明確になったものから順次 Formulation

### DON'T ❌
1. **フェーズに固執しない**: 「まずActive Listening、次に...」と硬直的に進めない
2. **完璧を目指さない**: 対話を通じて段階的に改善
3. **一度に全てをやらない**: 一部のルールだけ先に形式化しても良い
4. **技法を単独で使わない**: Example Mapping中にActive Listeningの質問を使うなど、柔軟に組み合わせる
5. **一人で完結させない**: 必ず対話を通じて作成

## 参照ドキュメント

### 子Skill（技法の引き出し）
- `active-listening/SKILL.md`: 傾聴と要求抽出の詳細
- `example-mapping/SKILL.md`: Example Mappingの詳細ワークフロー
- `formulation/SKILL.md`: Gherkin形式化の詳細

### リファレンス
- `reference/gherkin-rules.md`: Ruleキーワードのベストプラクティス
- `reference/acceptance-criteria-templates.md`: 受入基準テンプレート集
- `reference/collaboration-patterns.md`: 対話パターンと質問例

## 注意事項

- このskillは受入基準の**作成**に特化しています
- 実装やテストコード生成は別のskillで行います
- 3つの技法は状況に応じて柔軟に使い分けてください
- 行き詰まったら、別の技法に切り替えることを検討してください
- ストーリーが大きすぎる場合、分割を検討してください

---

*このskillは、Matt WynneのExample Mapping、Gojko AdzicのSpecification by Example、CucumberのGherkinベストプラクティス、カール・ロジャースのアクティブリスニングに基づいています*
