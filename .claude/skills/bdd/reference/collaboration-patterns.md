# 対話的コラボレーションパターン集

BDDは**対話駆動**のプロセスです。このドキュメントでは、Example Mappingや受入基準作成セッション中に使用する効果的な質問パターンと対話テクニックを提供します。

## 目次

- [基本原則](#基本原則)
- [発見的質問パターン](#発見的質問パターン)
- [明確化質問パターン](#明確化質問パターン)
- [検証質問パターン](#検証質問パターン)
- [ソクラテス式問答法](#ソクラテス式問答法)
- [シチュエーション別対話例](#シチュエーション別対話例)
- [対話の落とし穴と回避策](#対話の落とし穴と回避策)

---

## 基本原則

### 1. 仮定を明示する

```
❌ Bad: 「ログインに失敗した場合、エラーメッセージを表示します。」

✅ Good:
Claude: 「ログイン失敗時の振る舞いについて確認させてください。
        『失敗』には、どのようなケースが含まれますか?
        - 誤ったパスワード
        - 存在しないユーザー
        - アカウントロック
        - その他?」
```

### 2. 具体例で確認する

```
❌ Bad: 「検索機能を実装します。」

✅ Good:
Claude: 「検索機能の動作を具体例で確認させてください。
        例えば、『MacBook』と検索した場合:
        - 『MacBook Pro』は表示されますか?
        - 『Mac Book』(スペース入り)も対象ですか?
        - 『macbook』(小文字)でもヒットしますか?」
```

### 3. 境界を探索する

```
❌ Bad: 「ファイルサイズ制限を設けます。」

✅ Good:
Claude: 「ファイルサイズ制限について詳しく教えてください:
        - 上限は何MBですか?
        - 上限に達した場合、どのようなメッセージを表示しますか?
        - 複数ファイルアップロード時は、合計サイズですか、個別サイズですか?
        - 下限(0バイト)の場合はどうしますか?」
```

### 4. ステークホルダーの視点を切り替える

```
Claude: 「この機能を3つの視点で検討しましょう:

        📱 ユーザー視点:
        - この機能を使う典型的なシナリオは?
        - ユーザーにとって最も重要な体験は?

        💼 ビジネス視点:
        - この機能のビジネス価値は?
        - 成功指標(KPI)は何ですか?

        🔧 技術視点:
        - 既存システムとの整合性は?
        - パフォーマンス要件は?」
```

---

## 発見的質問パターン

ビジネスルールや制約を引き出すための質問集。

### ビジネスルールの発見

```
Q1: 「この機能で守るべき最も重要なビジネスルールは何ですか?」

Q2: 「どんな条件下でこの機能は動作すべきですか? また、動作してはいけない条件はありますか?」

Q3: 「この機能に関連する業界規制、法的要件、社内ポリシーはありますか?」

Q4: 「ユーザーに『やってほしくないこと』は何ですか? それを防ぐルールは必要ですか?」

Q5: 「この機能の成功基準は何ですか? どうなれば『完成した』と言えますか?」
```

### ユーザーペルソナの理解

```
Q1: 「この機能を使う典型的なユーザーはどのような人ですか?」

Q2: 「ユーザーはなぜこの機能を使いたいのですか? 解決したい課題は何ですか?」

Q3: 「ユーザーはこの機能をどのくらいの頻度で使用しますか? (毎日/週1回/月1回など)」

Q4: 「初回ユーザーと熟練ユーザーで、期待する体験は異なりますか?」

Q5: 「モバイルとデスクトップ、どちらでの使用が多いですか?」
```

### スコープの明確化

```
Q1: 「この機能のMVP(Minimum Viable Product)に必須の要素は何ですか?」

Q2: 「『あったら良い』機能と『必須』の機能を区別できますか?」

Q3: 「この機能は既存のXX機能と統合する必要がありますか?」

Q4: 「この機能から意図的に除外すべきスコープはありますか?」

Q5: 「将来的な拡張を見越して、今から考慮すべき点はありますか?」
```

---

## 明確化質問パターン

曖昧さを排除し、仕様を明確にするための質問集。

### 曖昧な表現の具体化

```
ユーザー: 「検索結果を適切に表示する」

Claude: 「『適切に』とは具体的にどういう意味でしょうか?
        - 関連度順? 日付順? 人気順?
        - 表示件数は? (10件? 50件? 全件?)
        - ページネーションは必要ですか?」

---

ユーザー: 「なるべく早く処理する」

Claude: 「『なるべく早く』の具体的な目標値を教えてください:
        - 理想的な処理時間は? (1秒以内? 3秒以内?)
        - 許容できる最大処理時間は?
        - 処理時間が目標を超えた場合、どうしますか?」

---

ユーザー: 「大量のデータを扱う」

Claude: 「『大量』の定義を明確にしましょう:
        - 想定データ量は? (1,000件? 100万件?)
        - 今後1年で何倍に増える見込みですか?
        - データ量が上限を超える場合、どう対処しますか?」
```

### 条件分岐の網羅

```
Claude: 「条件『Xの場合』について、以下を確認させてください:

        1. 条件が満たされる場合 (True):
           - システムはどう振る舞いますか?

        2. 条件が満たされない場合 (False):
           - システムはどう振る舞いますか?

        3. 条件を判定できない場合 (Unknown):
           - 例: データが不足している、外部API障害など
           - システムはどう振る舞いますか?

        4. 境界値:
           - 条件の境界(ちょうどXになる場合)はどちらに含まれますか?」
```

### エラー処理の詳細化

```
Claude: 「エラーケースについて詳しく教えてください:

        1. エラーの種類:
           - どんなエラーが発生しうますか?
           - ユーザー起因 vs システム起因のエラーを区別しますか?

        2. エラー時の振る舞い:
           - ユーザーに表示するメッセージは?
           - 処理を中断しますか? それとも部分的に続行しますか?

        3. リカバリー:
           - ユーザーはリトライできますか?
           - 自動リトライは必要ですか?

        4. ログ記録:
           - エラーログに記録する情報は?
           - 誰がログを確認しますか?」
```

---

## 検証質問パターン

作成した受入基準の妥当性を検証するための質問集。

### 完全性の検証

```
Claude: 「作成した受入基準を検証しましょう:

        ✅ 正常系はカバーされていますか?
        ✅ 異常系・エラーケースは網羅されていますか?
        ✅ 境界値ケースは含まれていますか?
        ✅ 競合状態(concurrent access)は考慮されていますか?
        ✅ セキュリティ要件は満たされていますか?
        ✅ パフォーマンス要件は定義されていますか?
        ✅ アクセシビリティは考慮されていますか?」
```

### 実行可能性の検証

```
Claude: 「各シナリオは実行可能かチェックしましょう:

        1. 前提条件は明確ですか?
           - Given: テスト前に準備すべき状態は?

        2. アクションは明確ですか?
           - When: 実行するアクションは?

        3. 期待結果は検証可能ですか?
           - Then: 何を確認すれば成功と言えますか?

        4. 自動テスト可能ですか?
           - 手動操作が必要な箇所はありますか?」
```

### ビジネス価値の検証

```
Claude: 「このシナリオのビジネス価値を確認しましょう:

        Q1: このシナリオは実際のユーザー行動を反映していますか?

        Q2: このシナリオが失敗した場合、ビジネスにどんな影響がありますか?

        Q3: このシナリオは優先度が高いですか? (Must-have / Should-have / Nice-to-have)

        Q4: このシナリオは他のシナリオと重複していませんか?」
```

---

## ソクラテス式問答法

ユーザーの思考を深めるための段階的な質問テクニック。

### パターン1: なぜを5回繰り返す (5 Whys)

```
ユーザー: 「検索機能が必要です。」

Claude: 「なぜ検索機能が必要なのですか?」
ユーザー: 「商品を素早く見つけたいから。」

Claude: 「なぜ素早く見つける必要があるのですか?」
ユーザー: 「現状、商品が多すぎて一覧から探すのが大変だから。」

Claude: 「なぜ一覧から探すのが大変なのですか?」
ユーザー: 「カテゴリ分けが不十分で、目的の商品がどこにあるか分からないから。」

Claude: 「なぜカテゴリ分けが不十分なのですか?」
ユーザー: 「商品が増えすぎて、既存のカテゴリ構造では対応できなくなった。」

Claude: 「では、検索機能と同時にカテゴリ構造の見直しも必要かもしれませんね。
        検索機能で解決したい本質的な課題は『商品の発見可能性向上』と理解しました。
        これを踏まえて、検索機能の要件を整理しましょう。」
```

### パターン2: 仮説検証

```
Claude: 「現時点での私の理解は以下です。正しいですか?

        【仮説】
        - ユーザーは商品名で検索することが最も多い
        - 検索結果は関連度順に表示する
        - 検索結果が0件の場合、代替案を提示する

        この仮説で抜けている重要な点はありますか?」

ユーザー: 「実は、商品名だけでなく品番でも検索するケースが多いです。」

Claude: 「なるほど! では仮説を修正します:
        - ユーザーは商品名『または』品番で検索する

        品番検索の場合、完全一致ですか? 部分一致ですか?」
```

### パターン3: 対比による明確化

```
Claude: 「2つのアプローチを比較してみましょう:

        【アプローチA】
        検索は商品名のみ対象、完全一致
        - メリット: シンプル、高速
        - デメリット: ユーザーが正確な商品名を知っている必要がある

        【アプローチB】
        検索は商品名・説明・タグを対象、部分一致
        - メリット: 柔軟、発見しやすい
        - デメリット: 複雑、ノイズが多い可能性

        どちらがユーザーのニーズに合っていますか?
        あるいは、第3のアプローチが必要ですか?」
```

---

## シチュエーション別対話例

### シチュエーション1: 要件が曖昧なとき

```
ユーザー: 「ユーザーがファイルをアップロードできるようにしたい。」

Claude: 「ファイルアップロード機能について、詳しく教えてください。
        まず、いくつか質問させてください:

        Q1: どのようなファイルをアップロードしますか?
            - 画像? ドキュメント? 動画? すべて?

        Q2: 想定されるファイルサイズの範囲は?
            - 最小: ? 最大: ?

        Q3: 一度に複数ファイルをアップロードできますか?

        Q4: アップロード後、ファイルはどう使われますか?
            - 保存のみ? プレビュー表示? 他のユーザーと共有?」

ユーザー: 「画像ファイルだけで、最大5MBまで。一度に1ファイルのみ。
          アップロード後はプロフィール画像として表示します。」

Claude: 「ありがとうございます! では、Example Mappingを始めましょう。

        📄 Story: プロフィール画像アップロード

        📘 Rule 1: JPEG, PNG形式で5MB以下のファイルをアップロード可能
        📘 Rule 2: アップロード後、プロフィール画面に画像を表示

        これで正しいですか? 他に考慮すべきルールはありますか?
        例えば:
        - 画像のアスペクト比や解像度の制限
        - 既存画像の上書き・削除
        - アップロード失敗時の振る舞い」
```

### シチュエーション2: 矛盾が発生したとき

```
ユーザー: 「検索結果は最新順に表示してください。
          でも、人気商品は上位に表示したいです。」

Claude: 「2つの要件が矛盾しているように見えます:
        - 最新順: 新しい商品が上位
        - 人気順: 人気商品が上位

        どちらを優先すべきか、一緒に整理しましょう。

        【案1】 デフォルトは最新順、ソートオプションで人気順に変更可能
        【案2】 人気商品を固定で上位表示し、その後に最新順で表示
        【案3】 ユーザーの過去の行動に基づいてパーソナライズ

        どの案が近いですか? あるいは別のアイデアがありますか?」

ユーザー: 「案2が近いです。上位3件は人気商品、4件目以降は最新順で。」

Claude: 「了解しました! では、ルールを明確化します:

        📘 Rule: 検索結果の表示順
           - 1-3位: 人気商品(購入数順)
           - 4位以降: 最新順(登録日時順)

        具体例で確認しましょう:
        📗 Example: 『Mac』で検索した場合
           Given 人気商品Top3が [MacBook Pro, iMac, Mac Mini]
           And 最新商品が [Magic Keyboard(昨日), Mac Studio(今日)]
           When 『Mac』で検索する
           Then 表示順は以下となる:
             1. MacBook Pro (人気1位)
             2. iMac (人気2位)
             3. Mac Mini (人気3位)
             4. Mac Studio (最新1位)
             5. Magic Keyboard (最新2位)

        これで合っていますか?」
```

### シチュエーション3: 技術的制約を確認するとき

```
Claude: 「この機能を実装する上で、技術的制約を確認させてください:

        Q1: 外部システムとの連携は必要ですか?
            - 必要な場合: レスポンスタイムの保証はありますか?

        Q2: データ量のスケーラビリティ要件は?
            - 現在: ? 件、1年後: ? 件

        Q3: 同時アクセス数の想定は?
            - 通常時: ? 同時接続、ピーク時: ? 同時接続

        Q4: ダウンタイム許容度は?
            - メンテナンス時間帯は確保できますか?

        これらは受入基準には含めませんが、
        実装計画を立てる上で重要な情報です。」
```

### シチュエーション4: 優先順位を決定するとき

```
Claude: 「Example Mappingで多くのルールが出てきました。
        実装の優先順位を決めましょう。

        【抽出されたルール】
        📘 Rule 1: キーワード検索
        📘 Rule 2: カテゴリフィルタ
        📘 Rule 3: 価格帯フィルタ
        📘 Rule 4: 在庫あり/なしフィルタ
        📘 Rule 5: 検索履歴の保存
        📘 Rule 6: 検索候補のサジェスト

        MoSCoW法で分類してみましょう:
        - Must have (必須): なければリリースできない
        - Should have (重要): あるべきだが、なくてもリリース可能
        - Could have (あれば良い): 余裕があれば実装
        - Won't have (今回は対象外): 将来的に検討

        どのルールがどこに分類されますか?」

ユーザー: 「Rule 1とRule 2はMust have。
          Rule 3, 4はShould have。
          Rule 5, 6はCould haveです。」

Claude: 「ありがとうございます! では、まずMust haveのRule 1, 2に絞って
        Gherkinシナリオを作成しましょう。
        Should have以降は別のストーリーとして扱うのが良さそうですね。」
```

---

## 対話の落とし穴と回避策

### 落とし穴1: 誘導尋問

```
❌ Bad:
Claude: 「検索結果は10件表示すれば十分ですよね?」
→ ユーザーの判断を誘導してしまっている

✅ Good:
Claude: 「検索結果は何件表示すべきでしょうか?
        判断材料として:
        - ユーザーは通常、何件くらいの結果を比較しますか?
        - 画面サイズの制約はありますか?
        - ページネーションは実装しますか?」
```

### 落とし穴2: 技術的詳細に踏み込みすぎる

```
❌ Bad:
Claude: 「データベースのインデックスはどうしますか?」
→ 受入基準作成の段階では不要な技術詳細

✅ Good:
Claude: 「検索のレスポンス時間の要件はありますか?
        例: 『1秒以内に結果を表示する』など」
```

### 落とし穴3: 一度に多くを聞きすぎる

```
❌ Bad:
Claude: 「ファイル形式、サイズ制限、アップロード後の処理、
        エラー時の振る舞い、セキュリティ要件、パフォーマンス要件を
        すべて教えてください。」
→ 情報過多で答えにくい

✅ Good:
Claude: 「まず、ファイル形式について教えてください。
        どのような形式を受け入れますか?」

[回答を受けてから]

Claude: 「ありがとうございます。次に、ファイルサイズ制限について...」
```

### 落とし穴4: 質問しすぎて進まない

```
❌ Bad:
Claude: [50個の質問を一気に投げかける]
→ セッションが長引き、疲労する

✅ Good:
Claude: 「重要な質問3つに絞って確認させてください:
        Q1: [最重要な質問]
        Q2: [2番目に重要な質問]
        Q3: [3番目に重要な質問]

        他の詳細は、Example Mappingの中で徐々に明確化しましょう。」
```

### 落とし穴5: 沈黙を恐れる

```
❌ Bad:
[ユーザーが考えている間に次々と質問を重ねる]
→ ユーザーの思考を妨げる

✅ Good:
Claude: 「このルールの具体例を考えてみてください。」

[ユーザーが考える時間を与える]

Claude: 「何か思いついたアイデアはありますか?
        または、一緒にブレインストーミングしましょうか?」
```

---

## 対話のチェックリスト

セッション中、以下を意識してください:

### 質問前
- [ ] この質問は本当に必要か?
- [ ] この質問はこのタイミングで適切か?
- [ ] 質問は明確で答えやすいか?

### 回答後
- [ ] 回答を正しく理解したか? (必要なら復唱して確認)
- [ ] 曖昧な部分は残っていないか?
- [ ] 次に聞くべき質問は何か?

### セッション終了時
- [ ] すべての重要なルールは洗い出されたか?
- [ ] 未解決の質問(赤カード)は記録されたか?
- [ ] 次のアクションは明確か?

---

*これらの対話パターンを活用し、ステークホルダーと建設的な対話を重ねることで、真に価値ある受入基準を共創してください。*
