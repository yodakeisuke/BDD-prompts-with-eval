# Example Mapping ワークフロー詳細

このドキュメントでは、Example Mappingセッションを段階的に実施するための詳細なワークフローを提供します。

## セッション準備 (5分前)

### 必要な参加者
- **3 Amigos** (最小構成):
  - 開発者 (Developer): 技術的実現可能性の視点
  - テスター (Tester): 品質とテストカバレッジの視点
  - プロダクトオーナー (Product Owner): ビジネス価値の視点

### 準備物
- タイマー (25分計測用)
- 仮想カードシステム (マークダウンまたはNotion等)
- ユーザーストーリー (As a... I want... So that... 形式)

### セッション開始前の確認
```
✅ ストーリーの内容を全員が理解しているか?
✅ 25分のタイムボックスを守る合意があるか?
✅ 記録係は決まっているか?
✅ 未解決の質問が出た場合の対処方法は決まっているか?
```

---

## Phase 1: ストーリーカードの作成 (0-5分)

### ステップ 1.1: ストーリーの定式化

ユーザーストーリーを**黄色カード**として配置します。

```markdown
📄 Story Card

As a [ユーザーペルソナ]
I want to [やりたいこと]
So that [ビジネス価値/理由]

【受け入れ基準】
- [大まかな成功基準1]
- [大まかな成功基準2]
```

**対話例:**

```
Claude: 「このセッションで扱うストーリーを確認します。」

📄 Story
As a オンラインショッピングユーザー
I want to 商品を検索する
So that 欲しい商品を素早く見つけられる

Claude: 「このストーリーで『成功』と言えるのはどんな状態ですか?」

PO: 「ユーザーがキーワードを入力して、関連する商品が表示されればOKです。」

Claude: 「ありがとうございます。それを黄色カードに追加します。」

📄 Story (Updated)
As a オンラインショッピングユーザー
I want to 商品を検索する
So that 欲しい商品を素早く見つけられる

受け入れ基準:
- ユーザーがキーワードを入力できる
- 関連する商品が表示される
```

### ステップ 1.2: スコープの境界確認

```
Claude: 「このストーリーに含めるもの、含めないものを明確にしましょう。」

【含める】
✅ キーワード検索
✅ 検索結果の表示

【含めない (今回は対象外)】
❌ 高度なフィルタリング (価格帯、カテゴリ等)
❌ 検索履歴の保存
❌ 検索サジェスト

Claude: 「このスコープで合っていますか?」
```

**タイムチェック:** ⏰ 5分経過

---

## Phase 2: ルールカードの抽出 (5-15分)

### ステップ 2.1: ビジネスルールのブレインストーミング

**目標:** ストーリーを支配するビジネスルールを洗い出す

**対話パターン:**

```
Claude: 「このストーリーで守るべきビジネスルールをブレインストーミングしましょう。
        思いついたルールを挙げてください。」

PO: 「検索キーワードは部分一致で探してほしい。」
→ 📘 Rule 1: キーワードに部分一致する商品を表示

Dev: 「検索結果が多すぎる場合の制限は?」
→ 📕 Question: 検索結果の最大表示件数は?

Tester: 「検索結果が0件の場合の振る舞いは?」
→ 📘 Rule 2: 検索結果が0件の場合、メッセージを表示

Claude: 「他にルールはありますか? 例えば:
        - 大文字/小文字の区別
        - 特殊文字の扱い
        - 検索速度の要件」

PO: 「大文字/小文字は区別しない。」
→ 📘 Rule 3: 検索は大文字/小文字を区別しない
```

### ステップ 2.2: ルールの整理と優先順位付け

抽出されたルールを整理します。

```
📘 Rule 1: キーワードに部分一致する商品を表示
📘 Rule 2: 検索結果が0件の場合、メッセージを表示
📘 Rule 3: 検索は大文字/小文字を区別しない
```

**ルールの妥当性チェック:**

```
Claude: 「各ルールについて、3つの視点で確認しましょう:

【Rule 1: キーワードに部分一致する商品を表示】
- 開発者視点: 実装可能ですか? パフォーマンス懸念は?
- テスター視点: テスト可能ですか? エッジケースは?
- PO視点: ビジネス価値はありますか?

Dev: 「実装可能です。ただし、商品数が増えるとインデックスが必要かも。」
→ 📕 Question: 将来的な商品数の見込みは? (スケーラビリティ)

Tester: 「『部分一致』の定義を明確にしたい。前方一致? 中間一致も?」
→ 📗 Example が必要 (次のフェーズで作成)

PO: 「これはコア機能なので、Must haveです。」
→ 優先度: 高
```

### ステップ 2.3: ルールの粒度調整

ルールが大きすぎる場合は分割、小さすぎる場合は統合します。

```
# ❌ ルールが大きすぎる例
📘 Rule: 検索機能のすべての動作
→ 具体的なルールに分割すべき

# ❌ ルールが小さすぎる例
📘 Rule: "MacBook" を検索すると "MacBook Pro" がヒットする
→ これは Example であり、Ruleではない

# ✅ 適切な粒度
📘 Rule: キーワードに部分一致する商品を表示
   📗 Example: "MacBook" → "MacBook Pro" ヒット
   📗 Example: "Mac" → "MacBook", "iMac" ヒット
```

**タイムチェック:** ⏰ 15分経過

---

## Phase 3: 具体例カードの作成 (15-23分)

### ステップ 3.1: 各ルールに対する具体例の抽出

各**青色カード**(Rule)に対して、**緑色カード**(Example)を作成します。

**対話パターン:**

```
Claude: 「では、Rule 1に対する具体例を考えましょう。
        『キーワードに部分一致する商品を表示』を説明する
        最もシンプルな例は何ですか?」

PO: 「『MacBook』と検索したら『MacBook Pro』が表示される。」

Claude: 「ありがとうございます。それを緑色カードにします。」

📘 Rule 1: キーワードに部分一致する商品を表示

   📗 Example 1.1: 完全一致するキーワード
      入力: "MacBook Pro"
      結果: "MacBook Pro" が表示される

Claude: 「他の例も考えてみましょう。部分一致とは、どの程度の部分一致ですか?」

Tester: 「『Mac』だけでも『MacBook Pro』『iMac』がヒットすべきでは?」

Claude: 「良い例ですね!」

   📗 Example 1.2: 前方部分一致
      入力: "Mac"
      結果: "MacBook Pro", "MacBook Air", "iMac" が表示される

Dev: 「中間一致はどうですか? 『Book』で『MacBook』がヒットする?」

PO: 「それは不要です。前方一致のみでOK。」

Claude: 「では、前方一致のみであることを明確にするため、
        中間一致しない例も追加しましょう。」

   📗 Example 1.3: 中間一致しない (ネガティブケース)
      入力: "Book"
      結果: 何も表示されない (前方一致ではないため)
```

### ステップ 3.2: 境界値とエッジケースの追加

```
Claude: 「境界値やエッジケースも考えましょう:

        - 空文字列を検索したら?
        - 特殊文字を含むキーワードは?
        - 非常に長いキーワードは?」

Tester: 「空文字列の場合、全商品を表示するのか、エラーにするのか?」

PO: 「全商品を表示します。」

   📗 Example 1.4: 空文字列
      入力: "" (空)
      結果: 全商品が表示される

Tester: 「特殊文字は?」

Dev: 「技術的にはエスケープが必要。ビジネス的にどう扱う?」

PO: 「特殊文字は無視して、文字部分だけで検索してほしい。」

   📗 Example 1.5: 特殊文字を含む
      入力: "Mac@Book"
      結果: "Mac", "Book" として検索 → "MacBook" 系がヒット

Claude: 「この仕様は複雑そうですね。実装優先度は?」

PO: 「これは Should have に下げます。まずは英数字のみで。」

→ 📘 Rule 1 を修正: 「英数字のキーワードに部分一致する商品を表示」
→ Example 1.5 は削除または別ストーリーに移動
```

### ステップ 3.3: 3つの視点で具体例をレビュー

```
Claude: 「作成した具体例を3つの視点でレビューしましょう:

【開発者視点】
- これらの例は実装可能ですか?
- 技術的に曖昧な部分はありませんか?

【テスター視点】
- これらの例は自動テスト可能ですか?
- カバレッジは十分ですか?

【PO視点】
- これらの例は実際のユーザー行動を反映していますか?
- ビジネス価値は明確ですか?」
```

**タイムチェック:** ⏰ 23分経過

---

## Phase 4: 質問カードの整理 (23-25分)

### ステップ 4.1: 赤カード(質問)の分類

セッション中に出てきた**赤色カード**(Question)を分類します。

```
📕 Questions

🔴 Blocker (実装前に解決必須)
Q1: 検索結果の最大表示件数は?
Q2: 将来的な商品数の見込みは? (スケーラビリティ)

🟡 Clarification (明確化すると品質向上)
Q3: 検索速度の要件は? (例: 3秒以内)
Q4: 検索ログは記録しますか?

🟢 Future (将来的に検討)
Q5: 検索履歴の保存機能は必要か?
Q6: 検索サジェスト機能は必要か?
```

### ステップ 4.2: 次アクションの決定

```
Claude: 「赤カードに対する次アクションを決めましょう:

🔴 Blocker
Q1: 検索結果の最大表示件数は?
→ 【Action】 PO が今すぐ決定する or ステークホルダーに確認

Q2: 将来的な商品数の見込みは?
→ 【Action】 Dev がデータチームに確認、明日までに回答

🟡 Clarification
Q3: 検索速度の要件は?
→ 【Action】 一旦「3秒以内」と仮定し、実装後に検証

Q4: 検索ログは記録しますか?
→ 【Action】 別ストーリーとして扱う (今回のスコープ外)

🟢 Future
Q5, Q6:
→ 【Action】 プロダクトバックログに追加、優先順位は後で決定
```

### ステップ 4.3: セッションのクロージング

```
Claude: 「Example Mappingセッションを完了します。まとめです:

【成果物】
📄 Story: 商品検索機能
📘 Rules: 3個
📗 Examples: 8個
📕 Questions: 6個 (Blocker 2個、Clarification 2個、Future 2個)

【次アクション】
- [ ] Q1, Q2を明日までに解決 (PO, Dev)
- [ ] Rule 1-3のGherkinシナリオ作成 (Dev, Tester)
- [ ] Q4-Q6をバックログに追加 (PO)

【判定】
✅ このストーリーは実装可能サイズ
✅ Blocker質問が2個のみで、解決可能
✅ 25分以内に完了

お疲れさまでした!」
```

**タイムチェック:** ⏰ 25分経過 (完了)

---

## タイムボックス超過時の対処

### 25分で終わらない場合の兆候

```
⚠️ 警告サイン:
- ルールが10個以上抽出された
- 赤カード(質問)が多すぎる (10個以上)
- ストーリーのスコープが曖昧
- ステークホルダー間で意見が割れている
```

### 対処法

```
Claude: 「25分を超過しそうです。以下のいずれかを選んでください:

【選択肢A】 ストーリーを分割する
→ 現在のストーリーが大きすぎる可能性
→ 小さな2-3個のストーリーに分割

【選択肢B】 スコープを縮小する
→ Must have のルールのみに絞る
→ Should have, Could have は別ストーリーへ

【選択肢C】 別途ステークホルダー会議を設定
→ ビジネス要件自体が不明瞭
→ Example Mappingの前にDiscoveryが必要

どれが適切ですか?」
```

---

## セッション後のフォローアップ

### 1. Gherkin形式への変換

Example Mappingの成果物をGherkin Feature fileに変換します。

```gherkin
Feature: 商品検索
  オンラインショッピングユーザーが商品を検索できる

  Background:
    Given 以下の商品が存在する
      | 商品名          |
      | MacBook Pro     |
      | MacBook Air     |
      | iMac            |
      | iPad Pro        |

  Rule: 英数字のキーワードに前方一致する商品を表示

    Example: 完全一致するキーワード
      Given 商品一覧画面を開いている
      When 検索キーワード "MacBook Pro" を入力する
      Then 商品 "MacBook Pro" が表示される

    Example: 前方部分一致
      Given 商品一覧画面を開いている
      When 検索キーワード "Mac" を入力する
      Then 以下の商品が表示される
        | MacBook Pro |
        | MacBook Air |

    Example: 中間一致しない (前方一致のみ)
      Given 商品一覧画面を開いている
      When 検索キーワード "Book" を入力する
      Then 検索結果は0件である

  Rule: 検索は大文字/小文字を区別しない

    Example: 小文字で検索
      Given 商品一覧画面を開いている
      When 検索キーワード "macbook" を入力する
      Then 商品 "MacBook Pro" と "MacBook Air" が表示される

  Rule: 検索結果が0件の場合、メッセージを表示

    Example: 存在しない商品名で検索
      Given 商品一覧画面を開いている
      When 検索キーワード "Surface" を入力する
      Then メッセージ "検索結果が見つかりませんでした" が表示される
```

### 2. 未解決質問の追跡

```markdown
# 未解決質問トラッカー

| ID  | 質問内容                     | 優先度 | 担当者 | 期限     | ステータス |
|-----|------------------------------|--------|--------|----------|------------|
| Q1  | 検索結果の最大表示件数は?     | 🔴     | PO     | 明日     | Open       |
| Q2  | 将来的な商品数の見込みは?     | 🔴     | Dev    | 明日     | Open       |
| Q3  | 検索速度の要件は?             | 🟡     | PO     | 来週     | Open       |
```

### 3. レトロスペクティブ (振り返り)

```
Claude: 「今回のExample Mappingセッションを振り返りましょう:

【うまくいった点】
✅ 25分以内に完了した
✅ 3つの具体的なルールを抽出できた
✅ Blockerが少なく、実装可能と判断できた

【改善点】
⚠️ 最初のスコープ定義に時間がかかった
   → 次回は事前にストーリーを共有しておく

⚠️ 技術的な議論に時間を費やしすぎた
   → 技術詳細は別途テクニカルセッションで議論

【学んだこと】
💡 『部分一致』という言葉の曖昧さが明らかになった
💡 具体例を挙げることで、ステークホルダー間の認識齟齬が解消された」
```

---

## 成功するExample Mappingのコツ

### Do ✅
1. **タイムボックスを厳守する** (25分)
2. **具体例で話す** (抽象論を避ける)
3. **質問を歓迎する** (赤カードに記録)
4. **全員が参加する** (3 Amigos全員の視点を活用)
5. **ルールは1-5個に絞る** (多すぎる場合はストーリー分割)

### Don't ❌
1. **完璧を目指さない** (完全性より対話)
2. **実装の詳細を議論しない** (技術的な解決策は後で)
3. **一人で決めない** (対話がBDDの本質)
4. **曖昧さを放置しない** (赤カードで明示)
5. **時間超過を許さない** (超過はストーリーが大きすぎるサイン)

---

*このワークフローをテンプレートとして、プロジェクトに合わせてカスタマイズしてください。*
