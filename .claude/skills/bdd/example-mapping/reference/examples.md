# Example Mapping 実例集

実際のExample Mappingセッションの記録例を示します。これらを参考に、自身のプロジェクトでセッションを実施してください。

## 目次

- [例1: ログイン機能](#例1-ログイン機能)
- [例2: ECサイトのカート機能](#例2-ecサイトのカート機能)
- [例3: タスク管理アプリの通知機能](#例3-タスク管理アプリの通知機能)
- [例4: API レート制限](#例4-api-レート制限)
- [例5: 複雑な例 - ストーリー分割が必要だったケース](#例5-複雑な例---ストーリー分割が必要だったケース)

---

## 例1: ログイン機能

### セッション情報
- **時間:** 20分
- **参加者:** PO (Sarah), Dev (Tom), Tester (Lisa)
- **結果:** ✅ 実装可能と判断

### 📄 Story Card

```markdown
As a 登録済みユーザー
I want to メールアドレスとパスワードでログインする
So that 個人の情報にアクセスできる
```

### 📘 Rule Cards & 📗 Example Cards

#### Rule 1: 有効な認証情報でログインできる

```markdown
📗 Example 1.1: 正しいメールアドレスとパスワード
Given ユーザー "alice@example.com" (パスワード: "SecurePass123") が登録されている
When メールアドレス "alice@example.com" を入力する
And パスワード "SecurePass123" を入力する
And ログインボタンをクリックする
Then ダッシュボード画面に遷移する
And ユーザー名 "Alice" が表示される
```

#### Rule 2: 無効な認証情報ではログインできない

```markdown
📗 Example 2.1: 誤ったパスワード
Given ユーザー "alice@example.com" が登録されている
When メールアドレス "alice@example.com" を入力する
And パスワード "WrongPassword" を入力する
And ログインボタンをクリックする
Then エラーメッセージ "メールアドレスまたはパスワードが正しくありません" が表示される
And ログイン画面に留まる

📗 Example 2.2: 存在しないメールアドレス
Given ユーザー "nonexistent@example.com" は登録されていない
When メールアドレス "nonexistent@example.com" を入力する
And パスワード "AnyPassword" を入力する
And ログインボタンをクリックする
Then エラーメッセージ "メールアドレスまたはパスワードが正しくありません" が表示される

📗 Example 2.3: 空のパスワード
Given ログイン画面を開いている
When メールアドレス "alice@example.com" を入力する
And パスワードを空欄のままにする
And ログインボタンをクリックする
Then エラーメッセージ "パスワードを入力してください" が表示される
```

#### Rule 3: 連続ログイン失敗でアカウントロック

```markdown
📗 Example 3.1: 5回連続失敗でロック
Given ユーザー "alice@example.com" が登録されている
And 過去4回連続でログインに失敗している
When 誤ったパスワードで5回目のログインを試みる
Then エラーメッセージ "アカウントがロックされました。30分後に再試行してください" が表示される
And アカウントがロック状態になる

📗 Example 3.2: ロック期間経過後の再ログイン
Given ユーザー "alice@example.com" のアカウントがロックされている
And ロックから30分経過している
When 正しいメールアドレスとパスワードでログインする
Then ログインが成功する
And ログイン失敗カウントがリセットされる
```

### 📕 Question Cards

```markdown
🔴 Blocker
Q1: ログイン失敗の連続回数は5回で良いか? (業界標準は3-5回)
→ Action: PO が確認、明日までに決定

🟡 Clarification
Q2: 「メールアドレスまたはパスワードが正しくありません」というメッセージは、
    どちらが間違っているか分からないようにするセキュリティ対策か?
→ Action: Yes (セキュリティベストプラクティスに従う)

Q3: ログイン成功時にログを記録するか?
→ Action: Yes (監査ログに記録)

🟢 Future
Q4: 二要素認証(2FA)は必要か?
→ Action: 次のストーリーで検討

Q5: ソーシャルログイン(Google, Facebookなど)は必要か?
→ Action: プロダクトバックログに追加
```

### 📋 Next Actions

```markdown
- [x] Q1をセキュリティチームに確認 (Sarah)
- [ ] Gherkinシナリオ作成 (Tom, Lisa)
- [ ] ログイン画面のUIモックアップ作成 (Designer)
- [ ] アカウントロック機能の技術調査 (Tom)
```

### 💡 セッションで学んだこと

```
✅ 「ログイン失敗」には複数のケースがある(誤パスワード、存在しないユーザー、空欄)
✅ セキュリティ要件(エラーメッセージの曖昧化、アカウントロック)が重要
✅ ログイン機能は比較的シンプルで、20分で完了できた
```

---

## 例2: ECサイトのカート機能

### セッション情報
- **時間:** 25分 (ギリギリ)
- **参加者:** PO (Ken), Dev (Maria), Tester (John)
- **結果:** ✅ 実装可能だが、在庫連携は別ストーリーに分割

### 📄 Story Card

```markdown
As a オンラインショッパー
I want to 商品をカートに追加する
So that 後でまとめて購入できる
```

### 📘 Rule Cards & 📗 Example Cards

#### Rule 1: 商品をカートに追加できる

```markdown
📗 Example 1.1: 初めてカートに商品を追加
Given カートが空である
When 商品 "MacBook Pro" をカートに追加する
Then カートに商品 "MacBook Pro" (数量: 1) が表示される

📗 Example 1.2: 既に存在する商品を追加
Given カートに商品 "MacBook Pro" (数量: 1) が入っている
When 商品 "MacBook Pro" をカートに追加する
Then カートの商品 "MacBook Pro" の数量が 2 になる

📗 Example 1.3: 異なる商品を追加
Given カートに商品 "MacBook Pro" (数量: 1) が入っている
When 商品 "iPad Pro" をカートに追加する
Then カートに以下の商品が表示される
  | 商品名      | 数量 |
  | MacBook Pro | 1    |
  | iPad Pro    | 1    |
```

#### Rule 2: カート内の商品数量を変更できる

```markdown
📗 Example 2.1: 数量を増やす
Given カートに商品 "MacBook Pro" (数量: 1) が入っている
When 数量を 3 に変更する
Then カートの商品 "MacBook Pro" の数量が 3 になる
And 合計金額が更新される

📗 Example 2.2: 数量を0にして削除
Given カートに商品 "MacBook Pro" (数量: 2) が入っている
When 数量を 0 に変更する
Then 商品 "MacBook Pro" がカートから削除される
```

#### Rule 3: カート内の商品を削除できる

```markdown
📗 Example 3.1: 削除ボタンで商品を削除
Given カートに以下の商品が入っている
  | 商品名      | 数量 |
  | MacBook Pro | 1    |
  | iPad Pro    | 1    |
When 商品 "iPad Pro" の削除ボタンをクリックする
Then 商品 "iPad Pro" がカートから削除される
And カートには商品 "MacBook Pro" のみが残る
```

#### Rule 4: カート合計金額を表示

```markdown
📗 Example 4.1: 複数商品の合計金額
Given カートに以下の商品が入っている
  | 商品名      | 単価    | 数量 |
  | MacBook Pro | 200,000 | 1    |
  | iPad Pro    | 100,000 | 2    |
When カート画面を表示する
Then 小計 400,000円 が表示される
And 消費税 40,000円 が表示される
And 合計 440,000円 が表示される
```

### 📕 Question Cards

```markdown
🔴 Blocker
Q1: カートに追加できる商品の最大数は?
→ Action: 無制限でOK (Ken)

Q2: カートの有効期限は? (例: 30日間保持)
→ Action: ログインユーザーは無期限、ゲストは7日間 (Ken)

🟡 Clarification
Q3: 在庫数を超える数量を追加しようとした場合は?
→ Action: これは別ストーリーに分割 (在庫連携機能として扱う)

Q4: 消費税率は固定? それとも設定可能?
→ Action: 現時点は10%固定、将来的に設定可能にする

🟢 Future
Q5: クーポン・割引コードの適用は?
→ Action: 別ストーリーとして扱う

Q6: カート内容を他のユーザーと共有する機能は?
→ Action: 優先度低、バックログに追加
```

### 📋 Next Actions

```markdown
- [x] Q1, Q2の仕様確定 (Ken)
- [ ] 在庫連携を別ストーリーとして作成 (Ken)
- [ ] カートのGherkinシナリオ作成 (Maria, John)
- [ ] カートUIのプロトタイプ作成 (Designer)
```

### 💡 セッションで学んだこと

```
✅ カート機能は見た目よりも複雑 (数量変更、削除、合計金額計算など)
⚠️ 在庫連携まで含めると25分を超過しそうだったため、スコープを分割した
✅ ゲストユーザーとログインユーザーでカートの振る舞いが異なることが明らかになった
```

---

## 例3: タスク管理アプリの通知機能

### セッション情報
- **時間:** 18分
- **参加者:** PO (Emma), Dev (Alex), Tester (Nina)
- **結果:** ✅ 実装可能、シンプルなストーリー

### 📄 Story Card

```markdown
As a タスク管理アプリユーザー
I want to タスクの期限が近づいたら通知を受け取る
So that タスクを忘れずに完了できる
```

### 📘 Rule Cards & 📗 Example Cards

#### Rule 1: 期限24時間前に通知を送信

```markdown
📗 Example 1.1: 明日が期限のタスク
Given 現在時刻が 2024-01-10 09:00 である
And タスク "レポート提出" の期限が 2024-01-11 09:00 である
And 通知設定が "24時間前" である
When 通知バッチ処理が実行される
Then 通知 "レポート提出の期限は明日です" が送信される

📗 Example 1.2: 期限が24時間より先のタスク
Given 現在時刻が 2024-01-10 09:00 である
And タスク "レポート提出" の期限が 2024-01-15 09:00 である
And 通知設定が "24時間前" である
When 通知バッチ処理が実行される
Then 通知は送信されない
```

#### Rule 2: 通知設定が「なし」の場合は通知しない

```markdown
📗 Example 2.1: 通知なし設定のタスク
Given 現在時刻が 2024-01-10 09:00 である
And タスク "レポート提出" の期限が 2024-01-11 09:00 である
And 通知設定が "なし" である
When 通知バッチ処理が実行される
Then 通知は送信されない
```

#### Rule 3: 通知は1度だけ送信される

```markdown
📗 Example 3.1: 同じタスクに対する重複通知を防ぐ
Given タスク "レポート提出" の期限が 2024-01-11 09:00 である
And 24時間前の通知が既に送信済み
When 通知バッチ処理が再度実行される
Then 通知は送信されない
And 通知履歴に "送信済み" と記録されている
```

### 📕 Question Cards

```markdown
🔴 Blocker
なし (すべて明確)

🟡 Clarification
Q1: 通知方法は? (メール? プッシュ通知? 両方?)
→ Action: 最初はメールのみ、将来的にプッシュ通知も追加 (Emma)

Q2: 通知バッチ処理の実行頻度は?
→ Action: 1時間ごと (Alex)

🟢 Future
Q3: カスタム通知タイミング設定は? (例: 1週間前、1時間前など)
→ Action: 次のイテレーションで検討

Q4: タスク完了済みの場合、通知を停止するか?
→ Action: Yes、完了済みタスクには通知しない (Emma)
```

### 📋 Next Actions

```markdown
- [x] 通知方法をメールに決定 (Emma)
- [ ] バッチ処理の技術設計 (Alex)
- [ ] Gherkinシナリオ作成 (Alex, Nina)
- [ ] メール通知テンプレート作成 (Designer)
```

### 💡 セッションで学んだこと

```
✅ シンプルなストーリーは18分で完了できる
✅ 通知機能は「いつ」「誰に」「何を」を明確にすることが重要
✅ バッチ処理の重複実行を考慮する必要があることが明らかになった
```

---

## 例4: API レート制限

### セッション情報
- **時間:** 22分
- **参加者:** PO (David), Dev (Sophie), Tester (Omar)
- **結果:** ✅ 実装可能、技術的な詳細も明確化

### 📄 Story Card

```markdown
As a APIプロバイダー
I want to ユーザーごとにAPIリクエスト数を制限する
So that システムを過負荷から保護できる
```

### 📘 Rule Cards & 📗 Example Cards

#### Rule 1: 無料プランは1時間あたり100リクエストまで

```markdown
📗 Example 1.1: 上限以内のリクエスト
Given 無料プランのユーザーがログインしている
And 過去1時間のリクエスト数が 50 である
When APIリクエストを送信する
Then リクエストが成功する (HTTP 200)
And レスポンスヘッダーに残りリクエスト数 49 が含まれる

📗 Example 1.2: 上限を超えるリクエスト
Given 無料プランのユーザーがログインしている
And 過去1時間のリクエスト数が 100 である
When APIリクエストを送信する
Then リクエストが拒否される (HTTP 429)
And エラーメッセージ "Rate limit exceeded. Retry after 3600 seconds" が返される
And レスポンスヘッダーに次回リセット時刻が含まれる
```

#### Rule 2: 有料プランは1時間あたり10,000リクエストまで

```markdown
📗 Example 2.1: 有料プランの大量リクエスト
Given 有料プランのユーザーがログインしている
And 過去1時間のリクエスト数が 5,000 である
When APIリクエストを送信する
Then リクエストが成功する (HTTP 200)
And レスポンスヘッダーに残りリクエスト数 4,999 が含まれる
```

#### Rule 3: レート制限は1時間ごとにリセットされる

```markdown
📗 Example 3.1: 時間経過後のリセット
Given 無料プランのユーザーがログインしている
And 1時間前に100リクエスト消費している
And 1時間が経過した
When APIリクエストを送信する
Then リクエストが成功する (HTTP 200)
And レスポンスヘッダーに残りリクエスト数 99 が含まれる
```

### 📕 Question Cards

```markdown
🔴 Blocker
Q1: レート制限のウィンドウは固定時間窓(例: 毎時0分リセット)か、
    スライディングウィンドウ(最初のリクエストから1時間)か?
→ Action: スライディングウィンドウを採用 (David)

🟡 Clarification
Q2: レート制限超過時、リトライまでの待機時間をどう計算するか?
→ Action: 最も古いリクエストから1時間後までの秒数を返す (Sophie)

Q3: エンタープライズプランのレート制限は?
→ Action: 無制限でOK (David)

🟢 Future
Q4: IPアドレスベースのレート制限は必要か?
→ Action: セキュリティ要件として別途検討

Q5: レート制限超過の通知機能は必要か?
→ Action: ユーザーダッシュボードに使用状況グラフを表示する機能を別ストーリーで検討
```

### 📋 Next Actions

```markdown
- [x] スライディングウィンドウ方式の技術調査 (Sophie)
- [ ] レート制限のGherkinシナリオ作成 (Sophie, Omar)
- [ ] APIドキュメントにレート制限仕様を追記 (Tech Writer)
- [ ] エンタープライズプランの価格設定確認 (Sales)
```

### 💡 セッションで学んだこと

```
✅ レート制限の「ウィンドウ方式」(固定 vs スライディング)を明確にする必要があった
✅ HTTPステータスコード 429 (Too Many Requests) を使用することで合意
✅ レスポンスヘッダーに残りリクエスト数を含めることで、ユーザー体験が向上する
```

---

## 例5: 複雑な例 - ストーリー分割が必要だったケース

### セッション情報
- **時間:** 25分 (超過しそうだったため途中で中断)
- **参加者:** PO (Rachel), Dev (Yuki), Tester (Carlos)
- **結果:** ⚠️ ストーリーが大きすぎる → 3つに分割

### 📄 Original Story Card (分割前)

```markdown
As a ブログ投稿者
I want to 記事を公開する
So that 読者に情報を届けられる
```

### 🔴 問題点

```
⚠️ 15分経過時点で以下の問題が発覚:
- ルールが12個も抽出された
- 赤カード(質問)が15個
- スコープが曖昧(下書き保存、予約投稿、公開後編集、SEO設定など)
- ステークホルダー間で意見が割れている

→ Claude: 「このストーリーは大きすぎます。分割を推奨します。」
```

### 📋 分割後のストーリー

#### Story 1: 記事の下書き作成 (Must have)

```markdown
As a ブログ投稿者
I want to 記事の下書きを作成・保存する
So that 後で編集を続けられる

📘 Rules:
- Rule 1: タイトルと本文を入力して下書き保存できる
- Rule 2: 下書きはいつでも編集できる
- Rule 3: 下書き一覧から下書きを検索できる

📕 Questions (Blocker):
Q1: 下書きの自動保存は必要か?
→ Action: Yes、30秒ごとに自動保存 (Rachel)
```

#### Story 2: 記事の公開 (Must have)

```markdown
As a ブログ投稿者
I want to 下書きを公開する
So that 読者に記事を届けられる

📘 Rules:
- Rule 1: 公開ボタンをクリックすると即座に公開される
- Rule 2: 公開済み記事は公開一覧に表示される
- Rule 3: 公開日時が記事に表示される

📕 Questions (Blocker):
Q2: 公開前のプレビュー機能は必要か?
→ Action: Yes、公開前にプレビュー画面を表示 (Rachel)
```

#### Story 3: 予約投稿 (Should have)

```markdown
As a ブログ投稿者
I want to 記事の公開日時を予約する
So that 指定した時刻に自動で公開できる

📘 Rules:
- Rule 1: 未来の日時を指定して予約投稿できる
- Rule 2: 予約時刻になると自動で公開される
- Rule 3: 予約投稿は公開前にキャンセル・編集できる

📕 Questions (Blocker):
Q3: 予約投稿の最大予約期間は?
→ Action: 制限なし (Rachel)
```

### 📋 Next Actions

```markdown
- [x] ストーリーを3つに分割 (Rachel)
- [ ] Story 1, 2を今スプリントで実装 (Yuki)
- [ ] Story 3は次スプリントに延期 (Rachel)
- [ ] 各ストーリーで再度Example Mappingセッション実施
```

### 💡 セッションで学んだこと

```
⚠️ 「記事を公開する」というストーリーは、実は複数の機能を含んでいた
✅ 25分を超過しそうな場合、無理に続けずにストーリー分割を検討すべき
✅ Must have / Should have で優先順位をつけることで、スコープを絞れた
✅ 分割後、各ストーリーは15-20分で完了できるサイズになった
```

---

## 実例から学ぶベストプラクティス

### 1. シンプルなストーリーは短時間で完了する

```
例1 (ログイン): 20分
例3 (通知): 18分

→ ルールが3-5個程度であれば、25分以内に完了可能
```

### 2. 複雑なストーリーは分割する

```
例5 (記事公開): 25分超過 → 3つに分割

→ ルールが10個以上、または質問が多すぎる場合は分割を検討
```

### 3. 技術的詳細とビジネスルールを区別する

```
例4 (APIレート制限):
- ビジネスルール: 「無料プランは100リクエスト/時間」
- 技術的詳細: 「スライディングウィンドウ方式」

→ ビジネスルールはExample Mappingで決定
→ 技術的詳細は別途技術設計で決定
```

### 4. 赤カード(質問)は優先度別に分類する

```
すべての例で、質問を以下に分類:
🔴 Blocker: 実装前に解決必須
🟡 Clarification: 明確化すると品質向上
🟢 Future: 将来的に検討

→ Blockerのみセッション中に解決を試みる
```

### 5. 具体例で曖昧さを排除する

```
例2 (カート):
「商品を追加する」という曖昧な表現を、
以下の具体例で明確化:
- 初めて追加
- 既存商品を追加(数量増加)
- 異なる商品を追加

→ 具体例により、実装の詳細が明確になる
```

---

## まとめ

これらの実例を参考に、以下を心がけてください:

1. **タイムボックス厳守** (25分)
2. **ルールは3-5個が目安** (多すぎる場合は分割)
3. **具体例で仕様を明確化**
4. **質問を歓迎し、赤カードに記録**
5. **ストーリー分割を恐れない**

Example Mappingは、完璧な仕様を作るためのツールではなく、
**対話を通じて仕様を発見するためのツール**です。

---

*これらの実例をテンプレートとして、あなたのプロジェクトに適用してください。*
