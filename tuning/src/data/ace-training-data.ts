/**
 * ACE Training Data: Complete BDD Example Mappings with Ground Truth
 *
 * 10 manually curated examples with full BDD JSON outputs
 * - Three Amigos coverage: Developer/Tester/PO perspectives
 * - Question pattern diversity: Discovery/Clarification/Boundary
 * - Example testability: Given/When/Then with concrete values
 */

import type { BDDExampleMapping } from '../types.js';

export interface ACEExample {
  input: {
    story_input: string;
  };
  output: BDDExampleMapping;
}

export const ACE_TRAINING_DATA: ACEExample[] = [
  // Example 1: CSV Import Automation (Medium Complexity)
  {
    input: {
      story_input:
        '予算データをExcelから手入力しているが、CSVインポートで自動化したい。',
    },
    output: {
      story: {
        as_a: '予算管理担当者として',
        i_want_to: 'CSVファイルから予算データを一括インポートできるようにしたい',
        so_that: '手入力の時間と入力ミスを削減できる',
      },
      rules: [
        {
          id: 'rule-1',
          name: 'CSVファイルのフォーマット要件',
          examples: [
            {
              given: 'CSVファイルに「部門コード,勘定科目,金額,期間」の4列が含まれている',
              when: 'ファイルをアップロードする',
              then: 'システムが正常にデータを認識する',
            },
            {
              given: 'CSVファイルに必須列が欠けている（例: 金額列がない）',
              when: 'ファイルをアップロードする',
              then: 'エラーメッセージ「必須列が不足しています: 金額」を表示する',
            },
          ],
        },
        {
          id: 'rule-2',
          name: 'インポート時のデータ検証',
          examples: [
            {
              given: 'CSVファイルに1000行の予算データが含まれている',
              when: 'インポートを実行する',
              then: 'すべての行が検証され、エラーがあれば行番号付きで表示される',
            },
            {
              given: 'CSVの500行目に無効な部門コード「INVALID」がある',
              when: 'インポートを実行する',
              then: 'エラー「行500: 部門コード「INVALID」は存在しません」を表示し、インポートを中止する',
            },
          ],
        },
        {
          id: 'rule-3',
          name: '既存データの上書きルール',
          examples: [
            {
              given: '既に登録済みの「営業部-2024年度-交通費」データが存在する',
              when: '同じ組み合わせのデータをCSVでインポートする',
              then: 'ユーザーに「上書き/スキップ/キャンセル」の選択肢を提示する',
            },
          ],
        },
      ],
      questions: {
        blocker: [
          '手入力とCSVインポートで予算データが重複した場合、どちらを優先しますか？',
          'CSVインポート中にエラーが発生した場合、部分的なインポートを許可しますか？それとも全ロールバックですか？',
        ],
        clarification: [
          'CSVファイルの文字コードはUTF-8のみ対応ですか？Shift_JISも必要ですか？',
          '勘定科目の表記ゆれ（「旅費交通費」と「交通費」）は自動補正しますか？',
          'インポート処理の進捗状況をユーザーに表示しますか？',
        ],
        future: [
          'Excelファイルのシートごとにインポート先部門を指定する機能は必要ですか？',
          'インポート履歴をログとして保存し、過去のインポートをロールバックできるようにしますか？',
        ],
      },
      next_actions: [
        'CSVフォーマット仕様書をステークホルダーと合意',
        'インポートエラー時のUI/UXをデザイナーと詰める',
        'バリデーションルールを開発チームと実装計画立案',
      ],
    },
  },

  // Example 2: Mapping Rules for Import (Medium Complexity)
  {
    input: {
      story_input:
        '実績データのインポート時、勘定科目の入力ミスが多い。マッピングルールで自動変換したい。',
    },
    output: {
      story: {
        as_a: '経理担当者として',
        i_want_to:
          '勘定科目の表記ゆれを自動的に正規化するマッピングルールを設定したい',
        so_that: 'インポート時の入力ミスを削減し、データ品質を向上できる',
      },
      rules: [
        {
          id: 'rule-1',
          name: 'マッピングルールの定義と適用',
          examples: [
            {
              given: 'マッピングルールで「旅費交通費」→「交通費」を定義している',
              when: 'CSVに「旅費交通費」が含まれている行をインポートする',
              then: '自動的に「交通費」に変換されてDBに保存される',
            },
            {
              given: 'マッピングルールが未定義の勘定科目「その他雑費」が存在する',
              when: 'その勘定科目を含むデータをインポートする',
              then: '警告「マッピングルール未定義: その他雑費」を表示し、そのままインポートする',
            },
          ],
        },
        {
          id: 'rule-2',
          name: 'マッピングルールの優先順位',
          examples: [
            {
              given: '「交通費」に対して2つのマッピングルール（優先度1: 旅費交通費、優先度2: 出張費）が存在する',
              when: 'CSVに「出張費」が含まれている',
              then: '優先度に関わらず「出張費」→「交通費」のルールが適用される',
            },
          ],
        },
        {
          id: 'rule-3',
          name: 'マッピングルールの管理',
          examples: [
            {
              given: '管理者権限を持つユーザーがログインしている',
              when: 'マッピングルール設定画面を開く',
              then: '既存ルールの一覧表示、追加、編集、削除ができる',
            },
            {
              given: '一般ユーザー権限でログインしている',
              when: 'マッピングルール設定画面にアクセスする',
              then: 'アクセス拒否エラー「この機能には管理者権限が必要です」を表示する',
            },
          ],
        },
      ],
      questions: {
        blocker: [
          '1つの入力値に対して複数のマッピング候補がある場合（例: 「経費」→「交通費」と「交際費」の両方）、どう処理しますか？',
          'マッピングルール適用後のデータは元の値を保持しますか？それとも完全に上書きしますか？',
        ],
        clarification: [
          'マッピングルールの部分一致（前方一致・後方一致・含む）は対応しますか？',
          'マッピングルールはインポート処理のみで適用ですか？手入力時にもリアルタイム適用しますか？',
          'ルール適用ログ（どの値がどう変換されたか）を記録しますか？',
        ],
        future: [
          'AIによる勘定科目の自動推薦機能（過去の傾向から学習）は必要ですか？',
          'マッピングルールを部門ごとに異なる設定にできるようにしますか？',
        ],
      },
      next_actions: [
        'マッピングルールの優先順位ロジックを開発チームと設計',
        '既存の勘定科目データから頻出する表記ゆれパターンを分析',
        '管理画面のUIワイヤーフレームを作成',
      ],
    },
  },

  // Example 3: Dashboard Real-time Visualization (Medium Complexity)
  {
    input: {
      story_input:
        '部門別の予算消化率をダッシュボードで可視化したい。リアルタイムで。',
    },
    output: {
      story: {
        as_a: '部門長として',
        i_want_to: '部門別の予算消化率をリアルタイムダッシュボードで確認したい',
        so_that: '進捗状況を常時把握し、早期の予算調整判断ができる',
      },
      rules: [
        {
          id: 'rule-1',
          name: 'ダッシュボードの表示内容',
          examples: [
            {
              given: '営業部の年間予算が1000万円、現在の実績が600万円である',
              when: 'ダッシュボードを開く',
              then: '消化率60%がプログレスバーで表示され、残予算400万円が併記される',
            },
            {
              given: '複数部門（営業部、開発部、管理部）のデータが存在する',
              when: 'ダッシュボードを開く',
              then: '全部門の消化率が降順（消化率が高い順）でリスト表示される',
            },
          ],
        },
        {
          id: 'rule-2',
          name: 'リアルタイム更新の挙動',
          examples: [
            {
              given: 'ダッシュボードを開いている状態で、別のユーザーが新しい実績を登録した',
              when: '30秒後',
              then: 'ダッシュボードの消化率が自動的に更新される（ページリロード不要）',
            },
            {
              given: 'ネットワーク接続が切断された',
              when: 'ダッシュボードを表示している',
              then: '警告「データ更新が停止しています。接続を確認してください」を表示する',
            },
          ],
        },
        {
          id: 'rule-3',
          name: '予算超過アラート',
          examples: [
            {
              given: '営業部の消化率が100%を超えた（予算超過）',
              when: 'ダッシュボードを表示する',
              then: '赤色の警告表示「予算超過: 120%」と超過金額が表示される',
            },
          ],
        },
      ],
      questions: {
        blocker: [
          'リアルタイム更新の頻度はどれくらいですか？（30秒ごと、1分ごと、データ変更時即座など）',
          '同時接続ユーザー数の想定は？（サーバー負荷対策が必要か判断）',
        ],
        clarification: [
          '消化率の計算基準は「実績÷予算」のみですか？未承認の実績も含めますか？',
          'ダッシュボードのデータをCSVやPDFでエクスポートする機能は必要ですか？',
          '過去の消化率推移をグラフで表示する機能は必要ですか？',
        ],
        future: [
          '消化率が80%を超えたら自動メール通知する機能は必要ですか？',
          'スマートフォンでのダッシュボード表示に対応しますか？',
        ],
      },
      next_actions: [
        'リアルタイム更新のアーキテクチャ（WebSocket or Polling）を技術選定',
        'ダッシュボードUIのモックアップ作成',
        '予算超過時のアラート仕様を詳細化',
      ],
    },
  },

  // Example 4: State-based Access Control (Complex)
  {
    input: {
      story_input:
        '承認済み予算は部門長も編集不可にしたい。CFOのみ編集可能。',
    },
    output: {
      story: {
        as_a: 'CFOとして',
        i_want_to: '承認済み予算の編集権限をCFOのみに制限したい',
        so_that: '承認後の不正変更を防止し、予算統制を強化できる',
      },
      rules: [
        {
          id: 'rule-1',
          name: '予算ステータスに応じた編集権限',
          examples: [
            {
              given: '予算ステータスが「承認済み」で、CFOロールのユーザーがログインしている',
              when: '予算編集画面を開く',
              then: '全フィールドが編集可能状態で表示される',
            },
            {
              given: '予算ステータスが「承認済み」で、部門長ロールのユーザーがログインしている',
              when: '予算編集画面を開く',
              then: '全フィールドが読み取り専用（グレーアウト）で表示され、編集できない',
            },
            {
              given: '予算ステータスが「下書き」で、部門長ロールのユーザーがログインしている',
              when: '予算編集画面を開く',
              then: '全フィールドが編集可能状態で表示される',
            },
          ],
        },
        {
          id: 'rule-2',
          name: 'API経由の編集リクエストの制御',
          examples: [
            {
              given: 'CFOではないユーザーが、承認済み予算のAPI更新リクエストを送信した',
              when: 'API処理が実行される',
              then: 'HTTP 403エラー「この予算は承認済みのため、CFOのみ編集可能です」を返す',
            },
          ],
        },
        {
          id: 'rule-3',
          name: '編集履歴の記録',
          examples: [
            {
              given: 'CFOが承認済み予算の金額を1000万円→1200万円に変更した',
              when: '保存ボタンを押す',
              then: '変更履歴に「日時: 2024-01-15 10:30、変更者: CFO太郎、変更内容: 金額 1000万円→1200万円」が記録される',
            },
          ],
        },
      ],
      questions: {
        blocker: [
          'CFOが複数人いる場合、全員に編集権限を付与しますか？それとも特定のCFOのみですか？',
          '承認済み予算を「下書き」に戻す機能は必要ですか？その場合、誰が戻せますか？',
        ],
        clarification: [
          'CFOによる承認済み予算の編集も、再承認フローが必要ですか？',
          '編集権限のロールは「CFO」だけですか？「システム管理者」も含めますか？',
          '予算ステータスは「下書き」「承認待ち」「承認済み」の3つのみですか？',
        ],
        future: [
          '承認済み予算の編集時に、監査ログとして別システムに通知する機能は必要ですか？',
          '特定条件下（例: 緊急対応）で部門長にも一時的な編集権限を付与できる仕組みは必要ですか？',
        ],
      },
      next_actions: [
        '予算ステータスの状態遷移図を作成',
        'ロール定義とアクセス制御マトリクスを整理',
        '編集履歴のデータモデル設計',
      ],
    },
  },

  // Example 5: Delegation & Proxy Input (Ambiguous)
  {
    input: {
      story_input:
        '部下に予算入力を代行させたい。でも最終確認は自分でしたい。',
    },
    output: {
      story: {
        as_a: '部門長として',
        i_want_to: '部下に予算入力を代行させつつ、最終確認は自分で行いたい',
        so_that: '業務を委譲しながらも予算の品質統制を維持できる',
      },
      rules: [
        {
          id: 'rule-1',
          name: '代理入力者の指定',
          examples: [
            {
              given: '部門長が「営業部-予算A」の代理入力者として「山田太郎」を指定した',
              when: '山田太郎がログインして予算一覧を開く',
              then: '「営業部-予算A」が「代理入力可能」タグ付きで表示される',
            },
            {
              given: '代理入力者に指定されていない予算データにアクセスしようとした',
              when: '山田太郎が「開発部-予算B」の編集画面を開こうとする',
              then: 'アクセス拒否エラー「この予算の編集権限がありません」を表示する',
            },
          ],
        },
        {
          id: 'rule-2',
          name: '代理入力後の承認フロー',
          examples: [
            {
              given: '代理入力者「山田太郎」が予算データを入力し、保存した',
              when: '保存処理が完了する',
              then: '予算ステータスが「代理入力完了・承認待ち」になり、部門長に通知メールが送信される',
            },
            {
              given: '部門長が「代理入力完了・承認待ち」の予算を確認し、内容に問題がない',
              when: '「承認」ボタンを押す',
              then: '予算ステータスが「承認済み」になり、代理入力者に完了通知が送信される',
            },
            {
              given: '部門長が代理入力内容を確認し、修正が必要と判断した',
              when: '「差し戻し」ボタンを押す',
              then: '予算ステータスが「下書き」に戻り、差し戻しコメントと共に代理入力者に通知される',
            },
          ],
        },
        {
          id: 'rule-3',
          name: '代理入力権限の期間制限',
          examples: [
            {
              given: '代理入力権限に期限「2024年1月31日まで」が設定されている',
              when: '2024年2月1日に代理入力者がログインする',
              then: '該当予算の代理入力権限が自動的に失効し、編集できなくなる',
            },
          ],
        },
      ],
      questions: {
        blocker: [
          '代理入力者が複数人いる場合、同時編集の競合をどう処理しますか？',
          '部門長が不在時、代理入力完了後の承認を誰が行いますか？代理承認者の設定は必要ですか？',
          '代理入力者が入力した内容を、部門長が直接編集できますか？それとも差し戻しのみですか？',
        ],
        clarification: [
          '代理入力権限の付与は予算単位ですか？それとも部門全体ですか？',
          '代理入力の履歴（誰がいつ何を入力したか）は記録しますか？',
          '代理入力者による保存時、自動で承認待ちステータスにしますか？それとも一時保存も可能にしますか？',
        ],
        future: [
          '代理入力者が複数の部門長から権限を付与された場合、一覧で管理できるダッシュボードは必要ですか？',
          '代理入力完了後、AIによる自動チェック（異常値検出など）を挟んでから部門長に通知しますか？',
        ],
      },
      next_actions: [
        '代理入力ワークフローの詳細シーケンス図を作成',
        '差し戻し時のコメント機能の仕様を詰める',
        '代理入力権限管理画面のUIモック作成',
      ],
    },
  },

  // Example 6: Bulk Budget Operations (Medium Complexity)
  {
    input: {
      story_input:
        '来期の人件費予算を今期比5%削減で入力したい。一括で設定できないか。',
    },
    output: {
      story: {
        as_a: '部門長として',
        i_want_to: '複数の予算項目に対して一括で増減率を適用したい',
        so_that: '予算編成時の手入力作業を削減し、効率的に調整できる',
      },
      rules: [
        {
          id: 'rule-1',
          name: '一括増減率の適用',
          examples: [
            {
              given: '営業部の人件費項目（基本給、賞与、法定福利費）の今期予算が合計1000万円である',
              when: '「人件費カテゴリ全体に-5%を適用」を実行する',
              then: '各項目が5%削減され、来期予算として950万円が設定される',
            },
            {
              given: '複数部門（営業部、開発部）を選択し、一括で+10%を適用する',
              when: '「一括増減」ボタンを押す',
              then: '選択した全部門の全予算項目が10%増加した値で来期予算に設定される',
            },
          ],
        },
        {
          id: 'rule-2',
          name: '一括適用前のプレビュー',
          examples: [
            {
              given: '人件費カテゴリに-5%を適用する設定をした',
              when: '「プレビュー」ボタンを押す',
              then: '適用前と適用後の金額比較表が表示され、「確定」または「キャンセル」を選択できる',
            },
          ],
        },
        {
          id: 'rule-3',
          name: '一括適用の除外設定',
          examples: [
            {
              given: '人件費カテゴリ内の「法定福利費」だけは削減対象外にしたい',
              when: '一括増減の除外項目に「法定福利費」を指定する',
              then: '法定福利費以外の項目にのみ-5%が適用される',
            },
          ],
        },
      ],
      questions: {
        blocker: [
          '一括増減の適用後、個別に微調整（手入力での上書き）は可能ですか？',
          '今期予算がゼロの項目に対して増減率を適用するとどうなりますか？（0円 × 1.05 = 0円）',
        ],
        clarification: [
          '増減率の小数点以下の扱いはどうしますか？（四捨五入、切り捨て、切り上げ）',
          '一括適用の対象範囲は「カテゴリ単位」「部門単位」「勘定科目単位」のどれですか？',
          '増減率の入力はパーセンテージのみですか？固定金額（例: 全項目+10万円）も対応しますか？',
        ],
        future: [
          '過去の予算推移から自動的に適切な増減率を提案する機能は必要ですか？',
          '一括適用の履歴を保存し、過去の一括操作を取り消せる機能は必要ですか？',
        ],
      },
      next_actions: [
        '一括増減のUI（プレビュー画面、除外設定）のワイヤーフレーム作成',
        '小数点処理のルールを財務部門と合意',
        '一括適用ロジックの実装計画を開発チームと策定',
      ],
    },
  },

  // Example 7: Multi-period Consolidation (Complex)
  {
    input: {
      story_input:
        '全部門の予算を統合して、勘定科目別サマリを自動生成したい。月次・四半期・年次の3パターン。',
    },
    output: {
      story: {
        as_a: '経理担当者として',
        i_want_to:
          '全部門の予算を勘定科目別に集計し、月次・四半期・年次のサマリレポートを自動生成したい',
        so_that: '手作業での連結作業を削減し、迅速な経営報告ができる',
      },
      rules: [
        {
          id: 'rule-1',
          name: '勘定科目別集計の生成',
          examples: [
            {
              given: '営業部の「交通費」が100万円、開発部の「交通費」が50万円である',
              when: '勘定科目別サマリを生成する',
              then: '「交通費: 150万円（営業部 100万円 + 開発部 50万円）」と集計される',
            },
            {
              given: '全10部門の予算データが存在する',
              when: '年次サマリを生成する',
              then: '全勘定科目（人件費、経費、設備投資など）の合計金額がレポートに表示される',
            },
          ],
        },
        {
          id: 'rule-2',
          name: '期間単位の集計パターン',
          examples: [
            {
              given: '2024年1月〜12月の予算データが登録されている',
              when: '月次サマリを生成する',
              then: '各月（1月、2月、...、12月）ごとの勘定科目別集計が生成される',
            },
            {
              given: '2024年1月〜12月の予算データが登録されている',
              when: '四半期サマリを生成する',
              then: 'Q1（1-3月）、Q2（4-6月）、Q3（7-9月）、Q4（10-12月）の4つの集計が生成される',
            },
            {
              given: '2024年1月〜12月の予算データが登録されている',
              when: '年次サマリを生成する',
              then: '2024年度全体の勘定科目別集計が1つのレポートとして生成される',
            },
          ],
        },
        {
          id: 'rule-3',
          name: '集計レポートのエクスポート',
          examples: [
            {
              given: '月次サマリが生成された状態',
              when: '「Excel出力」ボタンを押す',
              then: '月別シート、勘定科目別シート、部門別シートの3シート構成のExcelファイルがダウンロードされる',
            },
          ],
        },
        {
          id: 'rule-4',
          name: '部門間取引の相殺処理',
          examples: [
            {
              given: '営業部が開発部に「内部振替 +50万円」、開発部が営業部に「内部振替 -50万円」を計上している',
              when: '全社集計を生成する',
              then: '内部振替の相殺処理が行われ、全社合計には影響しない',
            },
          ],
        },
      ],
      questions: {
        blocker: [
          '部門間取引の相殺処理は必須ですか？それとも経理担当が手動で調整しますか？',
          '集計対象の予算ステータスは「承認済み」のみですか？「下書き」も含めますか？',
        ],
        clarification: [
          '四半期の定義は暦年（1-3月, 4-6月...）ですか？それとも会計年度基準（4-6月, 7-9月...）ですか？',
          'サマリレポートの更新頻度はどれくらいですか？（リアルタイム、日次バッチ、手動生成）',
          '集計結果のドリルダウン機能（例: 交通費をクリックすると部門別内訳が表示）は必要ですか？',
        ],
        future: [
          '前年同期比較機能（例: 2024年Q1 vs 2023年Q1）は必要ですか？',
          '予算vs実績の差異分析を同じレポートに含めますか？',
        ],
      },
      next_actions: [
        '四半期の定義（暦年 or 会計年度）を財務部と確認',
        '部門間取引の相殺ロジック詳細設計',
        'Excelエクスポートのテンプレートフォーマット作成',
      ],
    },
  },

  // Example 8: Scenario Planning (Complex)
  {
    input: {
      story_input:
        '複数の予算シナリオを比較したい。楽観・標準・悲観の3パターン。各シナリオで売上予測が違う。',
    },
    output: {
      story: {
        as_a: 'CFOとして',
        i_want_to:
          '楽観・標準・悲観の3つの予算シナリオを作成し、売上予測の違いによる影響を比較したい',
        so_that: '戦略的意思決定のためのシナリオ分析を実施できる',
      },
      rules: [
        {
          id: 'rule-1',
          name: 'シナリオの作成と管理',
          examples: [
            {
              given: '標準シナリオとして「2024年度予算-標準」が既に存在する',
              when: '「新規シナリオ作成」で「2024年度予算-楽観」を作成する',
              then: '標準シナリオのデータが複製され、新しいシナリオとして保存される',
            },
            {
              given: '3つのシナリオ（楽観・標準・悲観）が存在する',
              when: 'シナリオ一覧画面を開く',
              then: '各シナリオの名前、作成日、最終更新日、ステータスが一覧表示される',
            },
          ],
        },
        {
          id: 'rule-2',
          name: 'シナリオごとの売上予測設定',
          examples: [
            {
              given: '楽観シナリオの売上予測を「前年比+20%」に設定した',
              when: '売上予測を適用する',
              then: '全部門の売上予算が前年比+20%で自動計算される',
            },
            {
              given: '悲観シナリオの売上予測を「前年比-10%」に設定した',
              when: '売上予測を適用する',
              then: '全部門の売上予算が前年比-10%で自動計算され、関連するコスト項目も連動して調整される',
            },
          ],
        },
        {
          id: 'rule-3',
          name: 'シナリオ間の比較レポート',
          examples: [
            {
              given: '楽観・標準・悲観の3シナリオが全て完成している',
              when: '「シナリオ比較レポート」を生成する',
              then: '売上、営業利益、純利益の3項目について、3シナリオの並列比較表が表示される',
            },
            {
              given: 'シナリオ比較レポートが表示されている',
              when: '「グラフ表示」ボタンを押す',
              then: '3シナリオの損益推移を折れ線グラフで可視化する',
            },
          ],
        },
        {
          id: 'rule-4',
          name: 'シナリオの承認とロック',
          examples: [
            {
              given: '標準シナリオを取締役会で承認し、「承認済み」ステータスにした',
              when: '標準シナリオのデータを編集しようとする',
              then: 'CFO権限であっても編集不可となり、「このシナリオは承認済みのため編集できません」と表示される',
            },
          ],
        },
      ],
      questions: {
        blocker: [
          '売上予測の変動に連動して、コスト項目（例: 変動費）も自動調整しますか？その場合の計算ロジックは？',
          'シナリオの最大作成数に制限はありますか？（3つ固定 or 無制限）',
          '各シナリオのデータは完全に独立ですか？それとも一部の共通設定（例: 固定費）を持ちますか？',
        ],
        clarification: [
          'シナリオの複製元は常に「標準」シナリオですか？それとも任意のシナリオを選択できますか？',
          'シナリオごとに異なる前提条件（例: 為替レート、原材料価格）を設定できますか？',
          'シナリオ比較レポートはリアルタイム更新ですか？それとも手動生成ですか？',
        ],
        future: [
          'モンテカルロシミュレーションで確率的なシナリオ分析を行う機能は必要ですか？',
          '過去の予算vs実績データから、最も実現性の高いシナリオをAIが推薦する機能は必要ですか？',
        ],
      },
      next_actions: [
        'シナリオ間のデータ依存関係（独立 vs 共通設定）を財務部と確認',
        '売上→コスト連動の計算ロジック詳細設計',
        'シナリオ比較レポートのUIモックアップ作成',
      ],
    },
  },

  // Example 9: SAP API Integration (Complex)
  {
    input: {
      story_input:
        '会計システム（SAP）とリアルタイム連携したい。API経由で。実績データの自動取り込み。',
    },
    output: {
      story: {
        as_a: 'IT管理者として',
        i_want_to: 'SAPからAPI経由で実績データをリアルタイム自動取り込みしたい',
        so_that: '手動でのデータ転記作業を削減し、データ連携基盤を構築できる',
      },
      rules: [
        {
          id: 'rule-1',
          name: 'SAP API接続設定',
          examples: [
            {
              given: 'SAP APIの認証情報（エンドポイント、クライアントID、シークレット）が設定済み',
              when: '「接続テスト」ボタンを押す',
              then: 'SAP APIへの疎通確認が行われ、成功時に「接続成功」メッセージが表示される',
            },
            {
              given: 'SAP APIの認証情報が誤っている',
              when: '接続テストを実行する',
              then: 'エラー「SAP API認証失敗: クライアントIDまたはシークレットが無効です」を表示する',
            },
          ],
        },
        {
          id: 'rule-2',
          name: '実績データの自動取り込みスケジュール',
          examples: [
            {
              given: '毎日午前9時にSAPから実績データを取得する設定がされている',
              when: '午前9時になる',
              then: 'SAP APIから前日の実績データが自動的に取得され、DBに保存される',
            },
            {
              given: 'SAP APIからのデータ取得中にネットワークエラーが発生した',
              when: 'リトライ処理が3回失敗する',
              then: 'IT管理者にエラー通知メールが送信され、取り込み失敗ログが記録される',
            },
          ],
        },
        {
          id: 'rule-3',
          name: 'データマッピングとバリデーション',
          examples: [
            {
              given: 'SAPの勘定科目コード「4000」を自社システムの「交通費」にマッピング設定している',
              when: 'SAP APIから「4000」の実績データを取得する',
              then: '自動的に「交通費」として自社システムに登録される',
            },
            {
              given: 'SAPから取得したデータに、自社システムに存在しない部門コード「9999」が含まれている',
              when: 'データ取り込み処理を実行する',
              then: 'エラー「部門コード9999は存在しません」をログに記録し、該当行をスキップして処理を継続する',
            },
          ],
        },
        {
          id: 'rule-4',
          name: '取り込み履歴とロールバック',
          examples: [
            {
              given: '2024年1月15日午前9時の自動取り込みで500件のデータが登録された',
              when: '取り込み履歴画面を開く',
              then: '「日時: 2024-01-15 09:00、件数: 500件、ステータス: 成功」と表示される',
            },
            {
              given: '誤ったデータが取り込まれたため、2024年1月15日午前9時の取り込みをロールバックしたい',
              when: '該当履歴の「ロールバック」ボタンを押す',
              then: '確認ダイアログ「500件のデータを削除しますか？」が表示され、確定後に取り込みデータが削除される',
            },
          ],
        },
      ],
      questions: {
        blocker: [
          'SAP APIからのデータ取得頻度はどれくらいですか？（リアルタイム、1時間ごと、日次バッチ）',
          'SAP側のデータ更新と自社システムの取り込みにタイムラグがある場合、整合性をどう保証しますか？',
          'SAP APIが長時間ダウンした場合、過去のデータを遡って取得する機能は必要ですか？',
        ],
        clarification: [
          'SAP APIのレート制限（API call数の上限）はどれくらいですか？',
          'データマッピング設定は管理画面で変更可能にしますか？それともコード変更が必要ですか？',
          '取り込みエラー時の通知先は誰ですか？（IT管理者、財務担当者、両方）',
        ],
        future: [
          '自社システムからSAPへのデータ送信（双方向連携）も必要ですか？',
          'SAP以外の会計システム（Oracle、freeeなど）との連携も将来的に対応しますか？',
        ],
      },
      next_actions: [
        'SAP APIの技術仕様書をレビューし、データスキーマを確認',
        'データマッピング設定のマスタ管理方式を設計',
        'エラーハンドリングとリトライロジックの実装計画',
      ],
    },
  },

  // Example 10: Simple CSV Export (Low Complexity)
  {
    input: {
      story_input: '現在の予算データをCSVでエクスポートしたい。',
    },
    output: {
      story: {
        as_a: '予算管理担当者として',
        i_want_to: '現在の予算データをCSVファイルとしてエクスポートしたい',
        so_that: 'Excelで加工したり、他部門と共有できる',
      },
      rules: [
        {
          id: 'rule-1',
          name: 'CSV出力の基本機能',
          examples: [
            {
              given: '営業部の予算データ（10件）が登録されている',
              when: '「CSV出力」ボタンを押す',
              then: '「部門,勘定科目,金額,期間」の4列を持つCSVファイルがダウンロードされる',
            },
            {
              given: '予算データが0件（空）の状態',
              when: '「CSV出力」ボタンを押す',
              then: 'ヘッダー行のみのCSVファイルがダウンロードされる',
            },
          ],
        },
        {
          id: 'rule-2',
          name: 'CSVファイル名の規則',
          examples: [
            {
              given: '2024年1月15日にCSV出力を実行する',
              when: 'ダウンロードが開始される',
              then: 'ファイル名が「budget_export_20240115.csv」となる',
            },
          ],
        },
      ],
      questions: {
        blocker: [],
        clarification: [
          'CSV出力の対象は現在表示中のフィルタ結果ですか？それとも全データですか？',
          'CSV出力時の文字コードはUTF-8ですか？Shift_JISですか？',
        ],
        future: [
          'Excel形式（.xlsx）での出力も必要ですか？',
          'CSV出力時に特定の列だけを選択する機能は必要ですか？',
        ],
      },
      next_actions: [
        'CSV出力のカラム定義を確定',
        'ファイル名の命名規則を確認',
      ],
    },
  },
];

/**
 * Split training data into train/validation sets
 */
export function getACEDataset(options: { trainRatio?: number } = {}) {
  const { trainRatio = 0.7 } = options;
  const shuffled = [...ACE_TRAINING_DATA].sort(() => Math.random() - 0.5);
  const trainSize = Math.floor(shuffled.length * trainRatio);

  return {
    train: shuffled.slice(0, trainSize),
    validation: shuffled.slice(trainSize),
  };
}
